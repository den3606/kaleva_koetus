# Kaleva Koetus - 実装プラン

## アセンション1-20の具体的実装案

---

## 🌟 序盤アセンション（A1-A5）
*基本的な数値調整で難易度の基礎を作る*

### **A1: 敵の強化**
- **敵HP**: 1.15倍
- **実装**: `on_enemy_spawn`で敵のDamageModelComponentのmax_hpを調整

### **A2: 経済的制約**
- **ショップ価格**: 1.25倍
- **実装**: shop_price_mult = 1.25 をget_modifiersで返す

### **A3: 回復制限**
- **ヒール効果**: 0.8倍
- **実装**: healing_mult = 0.8 をget_modifiersで返す

### **A4: 敵ダメージ強化**
- **敵攻撃力**: 1.2倍
- **実装**: enemy_damage_mult = 1.2 をget_modifiersで返す

### **A5: 金貨減少**
- **金貨ドロップ**: 0.75倍
- **実装**: 金貨エンティティのValueComponentを調整

---

## ⚡ 中盤アセンション（A6-A10）
*プレイヤーの行動に制約を加える*

### **A6: マナ回復低下**
- **マナ回復速度**: 0.7倍
- **実装**: プレイヤーのShotEffectComponentを調整

### **A7: 魔法威力低下**
- **スペルダメージ**: 0.85倍
- **実装**: DamageByTypeComponentで魔法ダメージを調整

### **A8: 敵HP大幅強化**
- **敵HP**: 1.5倍（累積でA1と合わせて1.725倍）
- **実装**: A1と同様の手法

### **A9: 最大HP減少**
- **プレイヤー最大HP**: 0.9倍
- **実装**: `on_player_spawn`でmax_hpを調整

### **A10: ハート出現率低下**
- **ハート確率**: 0.6倍
- **実装**: ハートエンティティのスポーン確率を調整

---

## 🔥 上級アセンション（A11-A15）
*ゲームメカニクスに変化を加える*

### **A11: 毒ガス環境**
- **効果**: 60秒ごとにランダムな場所に毒雲発生
- **実装**: `on_update`でタイマー管理、EntityLoadを使用

### **A12: 敵グループ化**
- **効果**: 敵が50%の確率で2体同時出現
- **実装**: `on_enemy_spawn`で追加の敵をスポーン

### **A13: 呪いシステム**
- **効果**: 敵を倒すたびに呪いカウンタ+1、10で継続ダメージ
- **実装**: Globalsでカウンタ管理、`on_update`でダメージ処理

### **A14: 重力増加**
- **効果**: 重力を1.3倍に
- **実装**: PhysicsBodyComponentのgravity_scaleを調整

### **A15: エリート敵増加**
- **効果**: エリート敵出現率2倍
- **実装**: 特定タグの敵出現確率を操作

---

## 💀 極限アセンション（A16-A20）
*根本的なゲーム体験の変化*

### **A16: 魔法不安定化**
- **効果**: 魔法が15%の確率で失敗
- **実装**: `on_update`で魔法使用を監視、ランダムで無効化

### **A17: 視界制限**
- **効果**: 画面の25%にノイズエフェクト
- **実装**: カスタムシェーダーまたはオーバーレイエンティティ

### **A18: 時間制限**
- **効果**: 90分でゲームオーバー
- **実装**: タイマー管理、時間切れで強制ゲームオーバー

### **A19: ランダムテレポート**
- **効果**: 120秒ごとにプレイヤーがランダム移動
- **実装**: EntitySetTransformでプレイヤー位置変更

### **A20: カオスモード**
- **効果**: 上記すべての要素がランダムに発動
- **実装**: 複数のアセンション効果をランダムで一時的に適用

---

## 🛠 技術的実装メモ

### 使用するNoita API
- `ComponentGetValue2` / `ComponentSetValue2`: コンポーネント値の取得・設定
- `EntityLoad`: 新しいエンティティの生成
- `EntitySetTransform`: エンティティの位置変更
- `GameGetFrameNum`: フレーム数取得（タイマー用）
- `GlobalsGetValue` / `GlobalsSetValue`: 状態管理

### 実装パターン
1. **数値調整**: `get_modifiers()`で倍率を返す
2. **エンティティ操作**: `on_enemy_spawn` / `on_player_spawn`で直接調整
3. **継続効果**: `on_update`でフレームごとの処理
4. **環境変化**: 新しいエンティティを定期的にスポーン

### ファイル構成案
```
files/scripts/ascensions/
├── a1.lua   (敵HP強化)
├── a2.lua   (ショップ価格)
├── a3.lua   (回復制限)
├── ...
├── a19.lua  (ランダムテレポート)
└── a20.lua  (カオスモード)
```

---

## 📊 バランス調整指針

### 数値設定の考え方
- **序盤(A1-A5)**: 10-25%の変化で慣れを促す
- **中盤(A6-A10)**: 30-50%の変化で戦略変更を要求
- **上級(A11-A15)**: 新しいメカニクスに慣れる期間
- **極限(A16-A20)**: 根本的な挑戦、マスタープレイヤー向け

### テストプロセス
1. **単体テスト**: 各アセンション単独での動作確認
2. **累積テスト**: A1+A2+...+ANでの総合バランス
3. **ユーザビリティ**: プレイヤーが理解しやすいか
4. **パフォーマンス**: フレームレート低下がないか

---

*2025-09-21 作成 - 開発進行に応じて更新*