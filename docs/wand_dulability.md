# A10の杖の耐久値ロジック

- scripts/calc_wand_durability.luaにまとめる

## 仕様

- 杖の性能が高ければ高いほど、杖の耐久値は低くなる
- 杖の性能は以下の項目で決まる
  - Cast Delay(低いほどよい)
  - Recharge Time(低いほどよい)
  - Mana Max(高いほどよい)
  - Mana Charge Speed(高いほどよい)
  - Capacity(高いほどよい)
  - Spread(低いほどよい)
  - トータルで出した杖の性能に 0.7~1.5の耐久値補正をランダムにかける（耐久が伸びやすくする）
- 杖のそれぞれの性能に特定の倍率をかけて、normalize化を図る
  - 倍率はstaticにして、後で変更しやすくする
- 杖の生成座標のY値で深度ステージを計算し、深いほど耐久が高くなる補正を入れる
  - ベース耐久にステージ×定数を足した上で、深度ごとの倍率を掛ける
  - 512ピクセルごとにステージが1段階進み、ステージ7以降は同じ補正で頭打ち
- 杖の耐久値はVariableStorageComponentで管理する
- 杖の耐久値は、だれかがその杖を使えば使うほど減っていく
- 杖が壊れた場合
  - 杖を撃ってもスペルを射出できなくなる
  - スペル入れとしては使える
- 耐久値ロジックでは、杖のentityを引数に取り、耐久値を付与する
  - 返却値はなし(void)

### 耐久値仕様

- 耐久値は整数で端数は切り捨て
- 耐久値は杖を1回使うと1消費する
- レベル1帯の強い杖で、200-300回ぐらいは打てる必要がある
- 耐久値が0になったら杖を壊した判定になる

### 深度補正イメージ

| ステージ | 代表的なYレンジ(目安) | ベース加算 | 耐久倍率 |
|---------|----------------------|-----------|---------|
| 0 | 地表〜山小屋周辺 (~256px) | 0 | 0.90 |
| 1 | 炭鉱付近 (~256-768px) | +120 | 1.00 |
| 2 | 雪洞・真菌層 (~768-1280px) | +240 | 1.05 |
| 3 | 雪の城層 (~1280-1792px) | +360 | 1.15 |
| 4 | ジャングル層 (~1792-2304px) | +480 | 1.25 |
| 5 | ヴォルト層 (~2304-2816px) | +600 | 1.40 |
| 6 | 終盤層 (~2816-3328px) | +720 | 1.55 |
| 7+ | それ以深 | +840 | 1.70 |

> 実際のステージ計算は `depth_index = floor((y - 256) / 512)` を0〜7にクランプして行う。必要に応じて `DEPTH_BASELINE` や `DEPTH_STEP`、倍率テーブルを調整すること。
