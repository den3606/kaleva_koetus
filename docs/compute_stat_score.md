# `compute_stat_score` の挙動まとめ

このドキュメントでは、`files/scripts/calc_wand_durability.lua` 内の `compute_stat_score` がどのようにスコアを算出しているかを整理します。耐久値計算で使われる「杖性能スコア」の根幹ロジックを把握するためのリファレンスです。

## 基本ロジック

関数はステータス定義 (`STAT_CONFIG`) を入力に、対象のステータス値が基準値に対してどれだけ優れているかを正規化してスコア化します。返却値は「ペナルティの大きさ」で、値が大きいほど耐久値が削られます。

共通のパラメータ:

- `baseline`: この値を標準的な性能とみなす基準値
- `direction`: `"higher"` は値が大きいほど優秀、`"lower"` は値が小さいほど優秀
- `weight`: スコアを拡大する係数（比率が同じでも重みが大きいほどスコアが増える）
- `MAX_RATIO = 5.0`: 極端な値でも比率は 5 倍までに制限
- `MIN_VALUE = 0.01`: `direction = "lower"` でゼロ除算を防ぐための下限

### `direction = "higher"`

1. `ratio = value / baseline`（基準値に対する倍率）
2. `ratio <= 1` ならスコアは 0（基準を下回っているので加点なし）
3. `ratio` を `MAX_RATIO` でクリップ
4. スコア = `(ratio - 1) * weight`

### `direction = "lower"`

1. `ratio = baseline / max(value, MIN_VALUE)`（基準値よりどれだけ小さいかの逆比）
2. `ratio <= 1` ならスコアは 0（基準以上＝遅い／悪いので加点なし）
3. `ratio` を `MAX_RATIO` でクリップ
4. スコア = `(ratio - 1) * weight`

> メモ: どちらの方向でも「基準値を超えて優秀になった分だけスコアが増える」構造です。比率が 1 のときはスコア 0、比率 5 で重み分の最大スコアになります。

## ステータス別対応表

各ステータスごとに基準値と重み、代表的な入力値とスコアをまとめました（比率はクリップ前後が同じなので 1 列にしています）。値は小数第 2 位まで表示しています。

### Cast Delay（方向: 小さいほど良い）

| 入力値 | 基準比 (baseline/value) | スコア |
|-------:|-------------------------:|-------:|
| 5.00   | 5.00                     | 4.40   |
| 12.50  | 2.00                     | 1.10   |
| 25.00  | 1.00                     | 0.00   |
| 50.00  | 0.50                     | 0.00   |

### Recharge Time（方向: 小さいほど良い）

| 入力値 | 基準比 | スコア |
|-------:|-------:|-------:|
| 12.00  | 5.00   | 5.20   |
| 30.00  | 2.00   | 1.30   |
| 60.00  | 1.00   | 0.00   |
| 120.00 | 0.50   | 0.00   |

### Mana Max（方向: 大きいほど良い）

| 入力値 | 基準比 (value/baseline) | スコア |
|-------:|-------------------------:|-------:|
| 75.00  | 0.50                     | 0.00   |
| 150.00 | 1.00                     | 0.00   |
| 225.00 | 1.50                     | 0.50   |
| 450.00 | 3.00                     | 2.00   |

### Mana Charge Speed（方向: 大きいほど良い）

| 入力値 | 基準比 | スコア |
|-------:|-------:|-------:|
| 75.00  | 0.50   | 0.00   |
| 150.00 | 1.00   | 0.00   |
| 225.00 | 1.50   | 0.40   |
| 450.00 | 3.00   | 1.60   |

### Deck Capacity（方向: 大きいほど良い）

| 入力値 | 基準比 | スコア |
|-------:|-------:|-------:|
| 4.00   | 0.50   | 0.00   |
| 8.00   | 1.00   | 0.00   |
| 12.00  | 1.50   | 0.35   |
| 24.00  | 3.00   | 1.40   |

### Spread（方向: 小さいほど良い）

| 入力値 | 基準比 | スコア |
|-------:|-------:|-------:|
| 1.60   | 5.00   | 2.40   |
| 4.00   | 2.00   | 0.60   |
| 8.00   | 1.00   | 0.00   |
| 16.00  | 0.50   | 0.00   |

## 使いどころのヒント

- **重み (`weight`) が大きい項目ほど耐久値減少に強く寄与**します。特に `Recharge Time` と `Cast Delay` がペナルティを大きく伸ばします。
- 比率が 5.0 を超えるほど極端な性能でも、スコアは `(5 - 1) * weight` を上限とするため、無限に伸びることはありません。
- Spread や Cast Delay のように「小さいほど良い」値は、基準値の 1/5 まで縮めると最大スコアになります。

この表を見ながら、狙った耐久ラインに収まるように基準値や重みを調整してみてくださいね！
